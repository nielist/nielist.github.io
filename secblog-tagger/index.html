<!DOCTYPE html>
<html>
<head>
  <title>Textbox Demo</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script>
    function getUrlQuery(url) {
      if (typeof url === 'undefined' || url === '') {
        url = window.location;
      }
      return new URLSearchParams(url.search);
    }
    function setUrlQuery(params) {
      let urlParams = new URLSearchParams();
      for (const key of Object.keys(params)) {
        for (const value of Object.values(params[key])) {
          urlParams.append(key, value);
        }
      }
      let queryString = urlParams.toString();
      if (queryString.length > 0) {
        queryString = '?' + queryString;
      }
      window.history.replaceState({}, '', `${window.location.pathname}${queryString}`);
    }

    function onLoadUrl() {
      let params = getUrlQuery();
      for (const key of params.keys()) {
        if ($('#'+key).length <= 0) {
          $('input[type=text]#Code').val(key);
          onClickAddNewStock();
        }
      }
      for (const key of params.keys()) {
        if (params.has(key)) {
          let values = params.getAll(key);
          for (const value of values) {
            if (value != '') {
              $('#'+key).val(value);
            }
          }
        }
      }
    }

    function onClickTag() {
      let params = {};
      $('input[type=number].stock-shares').each(function(){
        let id = $(this).attr('id');
        let tag = $('#'+id).val();
        if (tag != '') {
          if (typeof params[id] === 'undefined') {
            params[id] = [];
          }
          params[id].push(''+tag);
        }
      });
      setUrlQuery(params);
    }
    var tagList = new Array();
    var articles = new Array();
    $.ajax({
      url: 'spotify.json',
      dataType: 'json',
      cache: false,
      success: function(data) {
        articles = data.playlist;
        $.each(articles, function(index, article) {
          $.each(article.tags, function(index, selectedTag) {
            if (tagList.length == 0 || tagList.indexOf(selectedTag) === -1) {
              // 如果tagList沒有這個tag
              tagList.push(selectedTag);
            }
          });
        });
        console.log(articles);
        console.log(tagList);
        // TODO: 在左邊顯示文章列表，在右邊顯示 tags 列表
        // 將 tags 列表顯示在右邊
        $.each(tagList, function(index, tag) {
          $('#tag-list').append('<a href="?tag=' + tag + '" class="tag" data-tag="' + tag + '"><span class="badge badge-primary">' + tag + '<span></a>');
        });
        
        // 當 tag 被點擊時
        $('.tag').click(function(e) {
          // 更新當前 URL query
          var tag = $(this).data('tag');
          var url = window.location.href.split('?')[0] + '?tag=' + tag;
          window.history.pushState({tag: tag}, '', url);
          
          // TODO: 根據 tag 顯示符合的文章列表
          displayArticleList();
          e.preventDefault();
          return false;
        });
      }
    });

    function displayArticleList() {
      // 從 URL query 中獲取 tag 參數
      var urlParams = new URLSearchParams(window.location.search);
      var selectedTag = urlParams.get('tag');
      
      // 顯示符合 selectedTag 的文章列表
      var articleList = $('#article-list');
      articleList.html();
      $.each(articles, function(index, article) {
        if (selectedTag && article.tags.indexOf(selectedTag) === -1) {
          // 如果有 selectedTag，但文章沒有這個 tag，則跳過
          return;
        }
        
        articleList.append('<div class="article">' + article.title + '</div>');
      });
    }
  </script>
</head>
<body>
  <div class="row">
    <div class="col-md-8" id="article-list">
      <!-- 文章列表 -->
    </div>
    <div class="col-md-4" id="tag-list">
      <!-- Tag 列表 -->
    </div>
  </div>
  <!--
  <div class="container mt-4">
    <div class="form-group">
      <label for="inputText">請輸入文字：</label>
      <input type="text" class="form-control" id="inputText" placeholder="在這裡輸入文字">
    </div>
    <div id="result"></div>
  </div>
  <script>
    $(document).ready(function() {
      $('#inputText').on('input', function() {
        var inputText = $(this).val();
        var keywords = ['Edge', 'Chrome', 'ChatGPT']; // 要匹配的特定字眼
        var result = '';
        for (var i = 0; i < keywords.length; i++) {
          if (inputText.includes(keywords[i])) {
            result += '<p>' + keywords[i] + '</p>';
          }
        }
        $('#result').html(result);
      });
    });
  </script>
  -->
</body>
</html>
